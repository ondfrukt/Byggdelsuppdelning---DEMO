<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Byggdelssystem - Objekt-baserat System</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/TreeView.css') }}">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <h1 class="logo">Byggdelssystem</h1>
            <nav class="nav">
                <button class="nav-btn active" data-view="dashboard">Dashboard</button>
                <button class="nav-btn" data-view="objects">Objekt</button>
                <button class="nav-btn" data-view="admin">Admin</button>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            <!-- Dashboard View -->
            <div id="dashboard-view" class="view active">
                <h2>Översikt</h2>
                <div class="stats-grid" id="stats-grid"></div>

                <div class="dashboard-sections">
                    <section class="dashboard-section">
                        <h3>Senaste Objekt</h3>
                        <div id="recent-objects" class="recent-list"></div>
                    </section>
                </div>
            </div>

            <!-- Objects View -->
            <div id="objects-view" class="view">
                <div class="view-header">
                    <h2>Objekt</h2>
                    <div>
                        <button class="btn btn-secondary" onclick="toggleTreeView()">
                            Trädvy
                        </button>
                        <button class="btn btn-primary" onclick="showCreateObjectModal()">
                            Skapa Objekt
                        </button>
                    </div>
                </div>
                <div id="objects-list-container" class="two-column-layout">
                    <div class="column-left">
                        <div id="objects-container"></div>
                    </div>
                    <div class="column-right">
                        <div id="objects-side-panel-container"></div>
                    </div>
                </div>
                <div id="tree-container" class="two-column-layout" style="display: none;">
                    <div class="column-left">
                        <div id="tree-view-container"></div>
                    </div>
                    <div class="column-right">
                        <div id="side-panel-container"></div>
                    </div>
                </div>
            </div>

            <!-- Admin View -->
            <div id="admin-view" class="view">
                <div id="admin-container"></div>
            </div>
        </div>
    </main>

    <!-- Modals -->
    <div id="modal-overlay" class="modal-overlay" onclick="closeModal()"></div>

    <!-- Object Modal -->
    <div id="object-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="object-modal-title">Skapa Objekt</h3>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            <form id="object-main-form" onsubmit="saveObject(event)">
                <div class="form-group">
                    <label for="object-type-select">Objekttyp *</label>
                    <select id="object-type-select" class="form-control" required>
                        <option value="">Välj objekttyp...</option>
                    </select>
                </div>
                <div id="object-form-container"></div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeModal()">
                        Avbryt
                    </button>
                    <button type="submit" class="btn btn-primary">
                        Spara
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Relation Modal -->
    <div id="relation-modal" class="modal">
        <div class="modal-content large-modal">
            <div class="modal-header">
                <h3>Skapa Relation</h3>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            <form id="relation-form" onsubmit="saveRelation(event)">
                <div class="form-group">
                    <label for="relation-type">Relationstyp *</label>
                    <select id="relation-type" class="form-control" required>
                        <option value="består_av">Består av</option>
                        <option value="variant_av">Variant av</option>
                        <option value="ersätter">Ersätter</option>
                        <option value="ersätts_av">Ersätts av</option>
                        <option value="kopplas_till">Kopplas till</option>
                        <option value="dokumenterar">Dokumenterar</option>
                        <option value="specificerar">Specificerar</option>
                        <option value="relaterad_till">Relaterad till</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="relation-object-type">Objekttyp *</label>
                    <select id="relation-object-type" class="form-control" required>
                        <option value="">Välj objekttyp...</option>
                    </select>
                </div>
                <div class="form-group" id="relation-objects-group" style="display: none;">
                    <label>Välj objekt *</label>
                    <div class="search-container">
                        <input type="text" id="relation-objects-search" class="form-control" placeholder="Sök objekt...">
                    </div>
                    <div id="relation-objects-list" class="objects-checklist"></div>
                </div>
                <div class="form-group">
                    <label for="relation-description">Beskrivning</label>
                    <textarea id="relation-description" class="form-control" rows="3"></textarea>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeModal()">
                        Avbryt
                    </button>
                    <button type="submit" class="btn btn-primary">
                        Skapa
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Object Type Modal (Admin) -->
    <div id="type-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="type-modal-title">Skapa Objekttyp</h3>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            <form id="type-form" onsubmit="saveObjectType(event)">
                <div class="form-group">
                    <label for="type-name">Namn *</label>
                    <input type="text" id="type-name" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="type-description">Beskrivning</label>
                    <textarea id="type-description" class="form-control" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label for="type-prefix">ID-prefix</label>
                    <input type="text" id="type-prefix" class="form-control" placeholder="t.ex. BYG">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeModal()">
                        Avbryt
                    </button>
                    <button type="submit" class="btn btn-primary">
                        Spara
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Field Modal (Admin) -->
    <div id="field-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="field-modal-title">Lägg till Fält</h3>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            <form id="field-form" onsubmit="saveField(event)">
                <div class="form-group">
                    <label for="field-name">Fältnamn *</label>
                    <input type="text" id="field-name" class="form-control" required 
                           placeholder="t.ex. namn, beskrivning">
                    <small class="form-help">Använd lowercase och understreck för mellanslag</small>
                </div>
                <div class="form-group">
                    <label for="field-display-name">Visningsnamn</label>
                    <input type="text" id="field-display-name" class="form-control" 
                           placeholder="t.ex. Namn, Beskrivning">
                </div>
                <div class="form-group">
                    <label for="field-type">Fälttyp *</label>
                    <select id="field-type" class="form-control" required>
                        <option value="text">Text</option>
                        <option value="textarea">Textområde</option>
                        <option value="number">Nummer</option>
                        <option value="decimal">Decimal</option>
                        <option value="date">Datum</option>
                        <option value="datetime">Datum & Tid</option>
                        <option value="boolean">Ja/Nej</option>
                        <option value="select">Val (dropdown)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="field-required">
                        Obligatoriskt fält
                    </label>
                </div>
                <div class="form-group">
                    <label for="field-help-text">Hjälptext</label>
                    <input type="text" id="field-help-text" class="form-control" 
                           placeholder="Valfri hjälptext för användaren">
                </div>
                <div class="form-group">
                    <label for="field-options">Alternativ (för dropdown)</label>
                    <input type="text" id="field-options" class="form-control" 
                           placeholder="Alt1, Alt2, Alt3 eller JSON array">
                    <small class="form-help">Komma-separerad lista eller JSON array</small>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeModal()">
                        Avbryt
                    </button>
                    <button type="submit" class="btn btn-primary">
                        Spara
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Bulk Edit Modal -->
    <div id="bulk-edit-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="bulk-edit-modal-title">Redigera flera objekt</h3>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            <form id="bulk-edit-form" onsubmit="saveBulkEdit(event)">
                <div id="bulk-edit-form-container"></div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeModal()">
                        Avbryt
                    </button>
                    <button type="submit" class="btn btn-primary">
                        Spara ändringar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Loading Spinner -->
    <div id="loading-spinner" class="loading-spinner" style="display: none;">
        <div class="spinner"></div>
    </div>

    <!-- Toast Notifications -->
    <div id="toast-container" class="toast-container"></div>

    <!-- Scripts -->
    <script src="{{ url_for('static', filename='js/api.js') }}"></script>
    <script src="{{ url_for('static', filename='js/utils.js') }}"></script>
    <script src="{{ url_for('static', filename='js/components/object-list.js') }}"></script>
    <script src="{{ url_for('static', filename='js/components/object-detail.js') }}"></script>
    <script src="{{ url_for('static', filename='js/components/object-form.js') }}"></script>
    <script src="{{ url_for('static', filename='js/components/relation-manager.js') }}"></script>
    <script src="{{ url_for('static', filename='js/components/file-upload.js') }}"></script>
    <script src="{{ url_for('static', filename='js/components/tree-view.js') }}"></script>
    <script src="{{ url_for('static', filename='js/components/side-panel.js') }}"></script>
    <script src="{{ url_for('static', filename='js/components/table-sort.js') }}"></script>
    <script src="{{ url_for('static', filename='js/admin/object-type-manager.js') }}"></script>
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>
