<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Byggdelssystem - Objekt-baserat System</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/TreeView.css') }}">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <h1 class="logo">Byggdelssystem - Test</h1>
            <nav class="nav">
                <button class="nav-btn active" data-view="objects">Objekt</button>
                <button class="nav-btn" data-view="file-objects">Filobjekt</button>
                <button class="nav-btn" data-view="tree">Trädvy</button>
                <button class="nav-btn" data-view="admin">Admin</button>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            <!-- Object Detail View -->
            <div id="object-detail-view" class="view">
                <div id="object-detail-container"></div>
            </div>

            <!-- Admin View -->
            <div id="admin-view" class="view">
                <div id="admin-container"></div>
            </div>

            <!-- File Objects View -->
            <div id="file-objects-view" class="view">
                <div id="file-objects-container"></div>
            </div>
        </div>

        <!-- Objects View - full width, outside container -->
        <div id="objects-view" class="view active">
            <div class="view-header">
                <h2 id="objects-view-title">Objekt</h2>
                <div class="view-header-actions">
                    <button class="btn btn-primary" id="objects-create-btn" onclick="showCreateObjectModal()">
                        Skapa Objekt
                    </button>
                </div>
            </div>
            <div class="object-list-layout">
                <div id="objects-container-wrapper" class="object-list-wrapper"></div>
                <div id="tree-view-wrapper" class="object-list-wrapper" style="display: none;">
                    <div id="tree-view-container"></div>
                </div>
                <!-- Detail Panel -->
                <div id="detail-panel" class="detail-panel">
                    <div class="detail-panel-header">
                        <div class="detail-panel-heading">
                            <h2 id="detail-panel-title">Objektdetaljer</h2>
                            <p id="detail-panel-category" class="detail-panel-category">Kategori: -</p>
                        </div>
                        <div class="detail-panel-header-actions">
                            <button id="detail-nav-back" class="detail-panel-nav-btn" type="button" onclick="navigateDetailHistory(-1)" title="Föregående objekt" aria-label="Föregående objekt" disabled>←</button>
                            <button id="detail-nav-forward" class="detail-panel-nav-btn" type="button" onclick="navigateDetailHistory(1)" title="Nästa objekt" aria-label="Nästa objekt" disabled>→</button>
                            <button id="detail-nav-edit" class="detail-panel-nav-btn" type="button" onclick="editCurrentDetailObject()" title="Redigera objekt" aria-label="Redigera objekt" disabled>✎</button>
                            <button class="detail-panel-close" onclick="closeDetailPanel()">&times;</button>
                        </div>
                    </div>
                    <div id="detail-panel-body" class="detail-panel-content"></div>
                </div>
            </div>
        </div>
    </main>

    <!-- Modals -->
    <div id="modal-overlay" class="modal-overlay" onclick="closeModal()"></div>

    <!-- Object Modal -->
    <div id="object-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="object-modal-title">Skapa Objekt</h3>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            <form id="object-main-form" onsubmit="saveObject(event)">
                <div class="form-group">
                    <label for="object-type-select">Objekttyp *</label>
                    <select id="object-type-select" class="form-control" required>
                        <option value="">Välj objekttyp...</option>
                    </select>
                </div>
                <div id="object-form-container"></div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeModal()">
                        Avbryt
                    </button>
                    <button type="submit" class="btn btn-primary">
                        Spara
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Relation Modal -->
    <div id="relation-modal" class="modal relation-modal" role="dialog" aria-modal="true" aria-labelledby="relation-modal-title" aria-describedby="relation-modal-description">
        <div class="modal-content relation-modal-content">
            <div class="modal-header">
                <div>
                    <h3 id="relation-modal-title">Lägg till relationer</h3>
                    <p id="relation-modal-source" class="modal-context"></p>
                    <p id="relation-modal-description" class="modal-subtitle">Sök, välj och koppla flera objekt i ett batch-anrop.</p>
                </div>
                <button class="close-btn" type="button" aria-label="Stäng relation-panel" onclick="closeRelationModal()">&times;</button>
            </div>

            <div id="relation-modal-feedback" class="relation-feedback" aria-live="polite"></div>

            <div class="relation-modal-layout">
                <section class="relation-table-section" aria-label="Sökbara objekt">
                    <div class="relation-filters">
                        <input type="text" id="relation-object-search" class="search-input" placeholder="Sök på namn, typ, beskrivning..." aria-label="Sök objekt för relation">
                        <select id="relation-object-type-filter" class="filter-select" aria-label="Filtrera på objekttyp">
                            <option value="">Alla objekttyper</option>
                        </select>
                    </div>

                    <div class="table-container relation-table-container">
                        <table class="data-table" id="relation-object-table">
                            <thead>
                                <tr id="relation-table-headers"></tr>
                                <tr id="relation-table-search-row" class="column-search-row"></tr>
                            </thead>
                            <tbody id="relation-object-table-body"></tbody>
                        </table>
                    </div>
                    <div class="relation-pagination">
                        <button type="button" id="relation-prev-page" class="btn btn-secondary btn-sm">Föregående</button>
                        <span id="relation-page-label">Sida 1</span>
                        <button type="button" id="relation-next-page" class="btn btn-secondary btn-sm">Nästa</button>
                    </div>
                </section>

                <aside class="relation-basket-section" aria-label="Valda objekt">
                    <div class="basket-header">
                        <h4>Korg (<span id="relation-basket-count">0</span>/200)</h4>
                        <div class="basket-actions">
                            <button type="button" id="relation-clear-basket" class="btn btn-secondary btn-sm">Rensa</button>
                            <button type="submit" form="relation-form" id="relation-connect-btn" class="btn btn-primary btn-sm">Koppla</button>
                        </div>
                    </div>
                    <div id="relation-basket-list" class="relation-basket-list"></div>

                    <form id="relation-form" class="relation-settings-form" onsubmit="saveRelation(event)">
                        <div class="form-group">
                            <label for="relation-metadata-note">Metadata: Notering</label>
                            <textarea id="relation-metadata-note" class="form-control" rows="2" placeholder="Gemensam notering för valda relationer"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="relation-description">Beskrivning</label>
                            <textarea id="relation-description" class="form-control" rows="2" placeholder="Valfri beskrivning"></textarea>
                        </div>
                    </form>
                </aside>
            </div>
        </div>
    </div>

    <!-- Object Type Modal (Admin) -->
    <div id="type-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="type-modal-title">Skapa Objekttyp</h3>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            <form id="type-form" onsubmit="saveObjectType(event)">
                <div class="form-group">
                    <label for="type-name">Namn *</label>
                    <input type="text" id="type-name" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="type-description">Beskrivning</label>
                    <textarea id="type-description" class="form-control" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label for="type-prefix">ID-prefix</label>
                    <input type="text" id="type-prefix" class="form-control" placeholder="t.ex. BYG">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeModal()">
                        Avbryt
                    </button>
                    <button type="submit" class="btn btn-primary">
                        Spara
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Field Modal (Admin) -->
    <div id="field-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="field-modal-title">Lägg till Fält</h3>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            <form id="field-form" onsubmit="saveField(event)">
                <div class="form-group">
                    <label for="field-name">Fältnamn *</label>
                    <input type="text" id="field-name" class="form-control" required 
                           placeholder="t.ex. namn, beskrivning">
                    <small class="form-help">Använd lowercase och understreck för mellanslag</small>
                </div>
                <div class="form-group">
                    <label for="field-display-name">Visningsnamn</label>
                    <input type="text" id="field-display-name" class="form-control" 
                           placeholder="t.ex. Namn, Beskrivning">
                </div>
                <div class="form-group">
                    <label for="field-type">Fälttyp *</label>
                    <select id="field-type" class="form-control" required>
                        <option value="text">Text</option>
                        <option value="textarea">Textområde</option>
                        <option value="number">Nummer</option>
                        <option value="decimal">Decimal</option>
                        <option value="date">Datum</option>
                        <option value="datetime">Datum & Tid</option>
                        <option value="boolean">Ja/Nej</option>
                        <option value="select">Val (dropdown)</option>
                        <option value="building_part_category">Byggdelskategori (admin-lista)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="field-required">
                        Obligatoriskt fält
                    </label>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="field-table-visible" checked>
                        Visbar i tabeller (objektvy/trädvy)
                    </label>
                </div>
                <div class="form-group">
                    <label for="field-help-text">Hjälptext</label>
                    <input type="text" id="field-help-text" class="form-control" 
                           placeholder="Valfri hjälptext för användaren">
                </div>
                <div class="form-group">
                    <label for="field-options">Alternativ (för dropdown)</label>
                    <input type="text" id="field-options" class="form-control" 
                           placeholder="Alt1, Alt2, Alt3 eller JSON array">
                    <small class="form-help">Komma-separerad lista eller JSON array. Ej relevant för byggdelskategori-fält.</small>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeModal()">
                        Avbryt
                    </button>
                    <button type="submit" class="btn btn-primary">
                        Spara
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Loading Spinner -->
    <div id="loading-spinner" class="loading-spinner" style="display: none;">
        <div class="spinner"></div>
    </div>

    <!-- Toast Notifications -->
    <div id="toast-container" class="toast-container"></div>

    <!-- Scripts -->
    <script src="{{ url_for('static', filename='js/api.js') }}"></script>
    <script src="{{ url_for('static', filename='js/utils.js') }}"></script>
    <script src="{{ url_for('static', filename='js/components/object-list-display-name.js') }}"></script>
    <script src="{{ url_for('static', filename='js/components/object-list.js') }}"></script>
    <script src="{{ url_for('static', filename='js/components/object-detail.js') }}"></script>
    <script src="{{ url_for('static', filename='js/components/object-form.js') }}"></script>
    <script src="{{ url_for('static', filename='js/components/relation-manager.js') }}"></script>
    <script src="{{ url_for('static', filename='js/components/file-upload.js') }}"></script>
    <script src="{{ url_for('static', filename='js/components/file-objects-view.js') }}"></script>
    <script src="{{ url_for('static', filename='js/components/tree-view.js') }}"></script>
    <script src="{{ url_for('static', filename='js/components/object-detail-panel.js') }}"></script>
    <script src="{{ url_for('static', filename='js/components/table-sort.js') }}"></script>
    <script src="{{ url_for('static', filename='js/admin/object-type-manager.js') }}"></script>
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>
